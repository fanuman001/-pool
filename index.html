<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELITE - é›²ç«¯å°è¦½ä¸­å¿ƒ</title>
    <style>
        :root { --blue: #00d2ff; --gold: #ffa502; --red: #ff4757; --bg: #0d1117; --card: #1c222b; --border: #30363d; --gray: #8b949e; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        
        .container { max-width: 600px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { color: var(--blue); margin: 0; font-size: 28px; letter-spacing: 2px; }
        .header p { color: var(--gray); font-size: 13px; margin-top: 5px; }

        /* æ¨¡å¼åˆ‡æ›æŒ‰éˆ• */
        .mode-toggle { text-align: right; margin-bottom: 15px; }
        .edit-btn { background: none; border: 1px solid var(--gray); color: var(--gray); padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; }
        .edit-btn.active { border-color: var(--gold); color: var(--gold); }

        /* é€£çµåˆ—è¡¨ */
        .nav-grid { display: grid; gap: 12px; }
        .nav-item { 
            background: linear-gradient(145deg, #1c222b, #161b22); border: 1px solid var(--border); border-radius: 16px; 
            padding: 18px; text-decoration: none; color: #fff; display: flex; 
            justify-content: space-between; align-items: center; transition: 0.2s; position: relative;
        }
        .nav-item:active { transform: scale(0.97); }
        .nav-info { flex-grow: 1; }
        .nav-title { font-size: 18px; font-weight: 700; color: #fff; }
        .nav-url { font-size: 11px; color: var(--gray); margin-top: 4px; font-family: monospace; }

        /* ç®¡ç†åŠŸèƒ½å€ */
        .admin-controls { display: none; gap: 8px; align-items: center; }
        .admin-mode .admin-controls { display: flex; }
        .admin-mode .arrow-btn { background: none; border: 1px solid #444; color: #fff; padding: 4px 8px; border-radius: 6px; }
        .delete-btn { color: var(--red); border: 1px solid var(--red); background: none; padding: 4px 8px; border-radius: 6px; font-size: 12px; }

        /* æ–°å¢è¡¨å–® */
        #add-form { 
            background: #161b22; border: 1px dashed var(--gold); border-radius: 16px; 
            padding: 15px; margin-bottom: 20px; display: none;
        }
        .admin-mode #add-form { display: block; }
        input { 
            width: 100%; background: #000; border: 1px solid var(--border); color: #fff; 
            padding: 12px; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; font-size: 14px;
        }
        .submit-btn { 
            width: 100%; background: var(--gold); border: none; padding: 12px; 
            border-radius: 10px; font-weight: bold; color: #000; cursor: pointer;
        }
        
        .loading-spinner { text-align: center; color: var(--gray); padding: 40px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ELITE HUB</h1>
        <p>æ‰€æœ‰è£ç½®åŒæ­¥å°è¦½ä¸­å¿ƒ</p>
    </div>

    <div class="mode-toggle">
        <button id="toggle-mode" class="edit-btn" onclick="toggleAdminMode()">âš™ï¸ ç®¡ç†æ¨¡å¼</button>
    </div>

    <div id="add-form">
        <input type="text" id="new-title" placeholder="ç«™é»åç¨± (å¦‚: æˆ°å ´è¨ˆç®—)">
        <input type="text" id="new-url" placeholder="ç¶²å€ (https://...)">
        <button class="submit-btn" onclick="addNewLink()">â• ç™¼ä½ˆè‡³é›²ç«¯æ¸…å–®</button>
    </div>

    <div id="nav-list" class="nav-grid">
        <div class="loading-spinner">ğŸ“¡ æ­£åœ¨åŒæ­¥é›²ç«¯æ•¸æ“š...</div>
    </div>
</div>

<script>
    // --- Supabase é…ç½® ---
    const API_URL = 'https://nzuxyiefpenwuqudajdw.supabase.co/rest/v1';
    const KEY = 'sb_publishable_7y2n8zIopxlKEhcsJ05D2A_U89IFgae';
    const HEADERS = { 'apikey': KEY, 'Authorization': 'Bearer ' + KEY, 'Content-Type': 'application/json', 'Prefer': 'return=representation' };

    let isAdmin = false;

    // 1. åˆå§‹åŒ–æŠ“å– (æŒ‰ sort_order æ’åº)
    async function fetchLinks() {
        const res = await fetch(`${API_URL}/nav_links?select=*&order=sort_order.asc`, { headers: HEADERS });
        const data = await res.json();
        render(data);
    }

    // 2. æ¸²æŸ“ UI
    function render(links) {
        const list = document.getElementById('nav-list');
        list.className = isAdmin ? 'nav-grid admin-mode' : 'nav-grid';
        
        if (links.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#555; padding:20px;">ç›®å‰æ²’æœ‰é€£çµ</div>';
            return;
        }

        list.innerHTML = links.map(link => `
            <div class="nav-item">
                <a href="${link.url}" target="_blank" class="nav-info" style="text-decoration:none;">
                    <div class="nav-title">${link.title}</div>
                    <div class="nav-url">${link.url}</div>
                </a>
                <div class="admin-controls">
                    <button class="arrow-btn" onclick="reorder(${link.id}, ${link.sort_order}, -1)">â–²</button>
                    <button class="arrow-btn" onclick="reorder(${link.id}, ${link.sort_order}, 1)">â–¼</button>
                    <button class="delete-btn" onclick="deleteLink(${link.id})">åˆªé™¤</button>
                </div>
            </div>
        `).join('');
    }

    // 3. åˆ‡æ›ç®¡ç†æ¨¡å¼
    function toggleAdminMode() {
        isAdmin = !isAdmin;
        document.getElementById('toggle-mode').classList.toggle('active', isAdmin);
        fetchLinks();
    }

    // 4. æ–°å¢é€£çµ (è‡ªå‹•è¨­ sort_order ç‚ºç•¶å‰æœ€å¤§å€¼+1)
    async function addNewLink() {
        const title = document.getElementById('new-title').value;
        const url = document.getElementById('new-url').value;
        if (!title || !url) return;

        // ç°¡å–®æ¬Šé‡ï¼šå–ç•¶å‰æ™‚é–“æˆ³
        const order = Date.now() % 1000000;

        await fetch(`${API_URL}/nav_links`, {
            method: 'POST',
            headers: HEADERS,
            body: JSON.stringify({ title, url, sort_order: order })
        });
        
        document.getElementById('new-title').value = '';
        document.getElementById('new-url').value = '';
        fetchLinks();
    }

    // 5. åˆªé™¤é€£çµ
    async function deleteLink(id) {
        if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹é€£çµå—ï¼Ÿ")) return;
        await fetch(`${API_URL}/nav_links?id=eq.${id}`, { method: 'DELETE', headers: HEADERS });
        fetchLinks();
    }

    // 6. æ’åºåŠŸèƒ½ (ç°¡å–®é‚è¼¯ï¼šèª¿æ•´ sort_order)
    async function reorder(id, currentOrder, direction) {
        const newOrder = currentOrder + direction;
        await fetch(`${API_URL}/nav_links?id=eq.${id}`, {
            method: 'PATCH',
            headers: HEADERS,
            body: JSON.stringify({ sort_order: newOrder })
        });
        fetchLinks();
    }

    fetchLinks();
</script>
</body>
</html>

